{% extends 'base/dashboard_base.html' %}

{% block title %}Dashboard - School Management System{% endblock %}

{% block dashboard_content %}
<div class="card">
    <h1 style="margin-bottom: 30px;">Dashboard Overview</h1>
    
    <!-- Dashboard stats using simple template context -->
    <div class="stats-grid">
        <div class="stat-card">
            <h3>{{ notice_count|default:"0" }}</h3>
            <p>Active Notices</p>
        </div>
        
        {% if perms.public.view_admissionapplication %}
        <div class="stat-card">
            <h3>{{ admission_count|default:"0" }}</h3>
            <p>Admission Applications</p>
        </div>
        {% endif %}
        
        <div class="stat-card">
            <h3>{{ user.groups.count }}</h3>
            <p>Your Roles</p>
        </div>
    </div>
</div>

<div class="card">
    <h2 style="margin-bottom: 20px;">Welcome, {{ user.first_name|default:user.email }}!</h2>
    
    {% if user.groups.exists %}
        <p style="margin-bottom: 15px;">Your current roles:</p>
        <ul style="margin-bottom: 20px;">
            {% for group in user.groups.all %}
                <li style="margin-bottom: 5px;">{{ group.name }}</li>
            {% endfor %}
        </ul>
    {% else %}
        <div style="background: #fff3cd; border: 1px solid #ffeaa7; padding: 15px; border-radius: 5px; margin-bottom: 20px;">
            <p style="color: #856404; margin: 0;">
                <strong>No roles assigned:</strong> You currently don't have any roles assigned. 
                Contact your administrator to get appropriate permissions.
            </p>
        </div>
    {% endif %}
    
    <h3 style="margin-bottom: 15px;">Quick Actions</h3>
    <!-- Quick actions based on user permissions -->
    <div style="display: flex; gap: 10px; flex-wrap: wrap;">
        <a href="{% url 'public:home' %}" class="btn">View Public Site</a>
        
        {% if perms.public.view_notice %}
        <a href="{% url 'dashboard:notice_management' %}" class="btn">Manage Notices</a>
        {% endif %}
        
        {% if perms.public.view_admissionapplication %}
        <a href="{% url 'dashboard:admission_management' %}" class="btn">View Applications</a>
        {% endif %}
        
        {% if perms.accounts.view_user %}
        <a href="{% url 'dashboard:user_management' %}" class="btn">Manage Users</a>
        {% endif %}
        
        {% if perms.auth.view_group %}
        <a href="{% url 'dashboard:role_management' %}" class="btn">Manage Roles</a>
        {% endif %}
    </div>
</div>

{% if not user.groups.exists %}
<div class="card">
    <h3 style="margin-bottom: 15px;">Available Content</h3>
    <p style="margin-bottom: 15px;">Even without specific roles, you can still:</p>
    <ul>
        <li style="margin-bottom: 5px;">View active notices</li>
        <li style="margin-bottom: 5px;">Access the public website</li>
        <li style="margin-bottom: 5px;">Update your profile information</li>
    </ul>
</div>
{% endif %}
{% endblock %}